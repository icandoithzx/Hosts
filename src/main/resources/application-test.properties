# 测试环境配置
spring.profiles.active=test

# 应用名称
spring.application.name=hosts-management-test

# 服务器端口
server.port=8080

# 日志配置
logging.config=classpath:logback-spring.xml
logging.level.com.example.demo=INFO
logging.level.org.springframework=WARN
logging.level.com.baomidou.mybatisplus=WARN

# 数据库配置 - MySQL（测试环境）
spring.datasource.url=jdbc:mysql://test-db-server:3306/hosts_management_test?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
spring.datasource.driverClassName=com.mysql.cj.jdbc.Driver
spring.datasource.username=${DB_USERNAME:hosts_test_user}
spring.datasource.password=${DB_PASSWORD:test_password}

# 数据库连接池配置 - 测试环境优化
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.maximum-pool-size=25
spring.datasource.hikari.idle-timeout=120000
spring.datasource.hikari.max-lifetime=600000
spring.datasource.hikari.connection-timeout=8000
spring.datasource.hikari.validation-timeout=3000
spring.datasource.hikari.leak-detection-threshold=45000
spring.datasource.hikari.connection-test-query=SELECT 1

# 数据库性能优化配置
spring.datasource.hikari.cache-prep-stmts=true
spring.datasource.hikari.prep-stmt-cache-size=350
spring.datasource.hikari.prep-stmt-cache-sql-limit=2048
spring.datasource.hikari.use-server-prep-stmts=true
spring.datasource.hikari.use-local-session-state=true
spring.datasource.hikari.rewrite-batched-statements=true
spring.datasource.hikari.cache-result-set-metadata=true
spring.datasource.hikari.cache-server-configuration=true
spring.datasource.hikari.elide-set-auto-commits=true
spring.datasource.hikari.maintain-time-stats=false

# H2控制台禁用（测试环境安全）
spring.h2.console.enabled=false

# Redis配置
spring.redis.host=${REDIS_HOST:test-redis-server}
spring.redis.port=${REDIS_PORT:6379}
spring.redis.password=${REDIS_PASSWORD:test_redis_password}
spring.redis.timeout=3000ms
spring.redis.jedis.pool.max-active=25
spring.redis.jedis.pool.max-idle=10
spring.redis.jedis.pool.min-idle=2
spring.redis.jedis.pool.max-wait=2000ms

# 数据库初始化
spring.sql.init.mode=always
spring.sql.init.schema-locations=classpath:schema.sql,classpath:db_performance_optimization_indexes.sql
spring.sql.init.data-locations=classpath:data.sql

# MyBatis Plus配置
mybatis-plus.mapper-locations=classpath*:/mapper/**/*.xml
mybatis-plus.type-aliases-package=com.example.demo.model.entity
mybatis-plus.configuration.map-underscore-to-camel-case=true
mybatis-plus.configuration.cache-enabled=true
mybatis-plus.configuration.lazy-loading-enabled=true
mybatis-plus.configuration.multiple-result-sets-enabled=true
mybatis-plus.configuration.use-column-label=true
mybatis-plus.configuration.auto-mapping-behavior=partial

# 外部API配置
external.organization.api.url=${EXTERNAL_ORG_API_URL:http://test-api-server:9999/api/organizations}
external.organization.sync.enabled=${EXTERNAL_ORG_SYNC_ENABLED:true}

# 用户同步配置
external.user.api.url=${EXTERNAL_USER_API_URL:http://test-api-server:9999/api/users}
external.user.sync.enabled=${EXTERNAL_USER_SYNC_ENABLED:true}

# AI模型API配置
ai.model.api.ip=${AI_MODEL_IP:test-ai-server}
ai.model.api.port=${AI_MODEL_PORT:8000}

# 安全配置
server.error.include-stacktrace=on-param
server.error.include-message=always

# 监控配置
management.endpoints.web.exposure.include=health,info,metrics,env
management.endpoint.health.show-details=always
management.metrics.export.prometheus.enabled=true

# 心跳服务配置优化
heartbeat.timeout.minutes=5
heartbeat.offline.check.interval=120000
heartbeat.cache.ttl.minutes=30
heartbeat.max.concurrent.requests=500